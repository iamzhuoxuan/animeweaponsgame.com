# 📖 产品需求文档 (PRD)

好的，这是基于我们之前所有讨论和技术选型（Next.js 14 App Router + Sanity CMS）的 **Anime Weapons 攻略站** 最终版产品需求文档。

## **项目名称：Anime Weapons 攻略站 (最终架构版)**



| **属性**       | **值**                                |
| -------------- | ------------------------------------- |
| **版本号**     | **V2.0 (完整架构)**                   |
| **创建日期**   | 2025年11月28日                        |
| **产品负责人** | AI/开发者 (您)                        |
| **目标受众**   | Roblox 玩家，Anime Weapons 进阶玩家 |

------



## 1. 目标与愿景 (Goals & Vision)





### 1.1 产品愿景



成为 Roblox 游戏 **Anime Weapons** 社区中，**更新最快、数据最准确、且具备高级内容关联能力**的第三方攻略与数据查询平台。



### 1.2 核心目标



1. **流量获取：** 通过 "兑换码" 和 "强度榜" 关键词，实现网站 SEO 领先。
2. **数据权威性：** 提供准确的角色数值和复杂的进化配方，成为社区首选数据源。
3. **用户粘性：** 通过文章系统与角色数据库的**双向关联**，提高用户在网站内的停留时间。

------



## 2. 网站架构与地图 (Architecture & Sitemap)



网站采用 Next.js 14 App Router 结构，利用 RSC (React Server Components) 实现数据获取。

| **路由 (Path)** | **页面名称**  | **页面功能概要**                                             |
| --------------- | ------------- | ------------------------------------------------------------ |
| `/`             | 首页          | Dashboard。显示 **最新兑换码摘要**、**当前 Tier List 简报**、最新文章。 |
| `/codes`        | 兑换码大全    | 完整的有效/过期代码列表。支持一键复制。                      |
| `/tierlist`     | 强度排行榜    | **核心**：显示 SSS/SS/S/A 分级的角色列表，支持按模式筛选 (PvE, Infinite)。 |
| `/units`        | 角色图鉴列表  | 所有角色的卡片式列表。可按稀有度、属性筛选。                 |
| `/units/[slug]` | 角色详情页    | 基础属性、立绘、**完整的进化材料配方**、**相关攻略文章列表 (反向关联)**。 |
| `/blog`         | 攻略文章列表  | 显示所有文章标题、摘要、发布日期。                           |
| `/blog/[slug]`  | 攻略文章详情  | 文章正文。侧边栏必须展示**关联角色卡片 (正向关联)**。        |
| `/studio`       | Sanity Studio | **管理后台**：内容编辑与数据维护入口。                       |



## 3. 页面功能详情与组件列表 (Page Structure & Components)



本节详细定义了各主要页面的结构和包含的组件。



### 3.1 首页 (Home / `/`)



| **区域/组件**               | **功能介绍**                                                 | **数据来源**          |
| --------------------------- | ------------------------------------------------------------ | --------------------- |
| **Header**                  | 网站 Logo 与主导航栏 (Home, Units, Tier List, Codes)。       | 硬编码 / Next.js 路由 |
| **最新公告**                | 显示最新版本补丁或活动摘要。                                 | MDX/Sanity `article`  |
| **Tier List 简报 (Widget)** | 显示当前版本 **SSS 级** 角色卡片（至多 3 个），吸引用户点击进入完整榜单。 | Sanity `tierList`     |
| **兑换码摘要 (Widget)**     | 显示最新的 3 个 **Active** 兑换码，提供一键复制。            | Sanity `redeemCode`   |
| **文章摘要列表**            | 5 篇最新发布的攻略文章标题与摘要。                           | Sanity `article`      |



### 3.2 角色图鉴列表页 (Unit Index / `/units`)



| **区域/组件**    | **功能介绍**                                                 | **数据来源**                          |
| ---------------- | ------------------------------------------------------------ | ------------------------------------- |
| **搜索与过滤栏** | 支持按名称搜索；提供按**稀有度** (Secret, Mythic)、**定位** (AoE/Single) 的筛选按钮。 | 前端 State & Sanity `unit` GROQ Query |
| **角色卡片网格** | 列表视图，每张卡片展示**头像、名称、稀有度**。点击卡片跳转到详情页。 | Sanity `unit`                         |



### 3.3 角色详情页 (Unit Profile / `/units/[slug]`)



| **区域/组件**               | **功能介绍**                                                 | **对应 FR-ID** |
| --------------------------- | ------------------------------------------------------------ | -------------- |
| **主信息面板**              | 展示角色立绘、名称、**稀有度标签** (FR405 - 颜色区分)。      | FR405          |
| **数值面板**                | 展示部署费用、初始伤害、攻速、射程等核心数值。               | FR406          |
| **进化配方组件**            | **核心展示区。** 以清晰的图标和数量列表，展示所需的材料。    | FR405, FR408   |
| **相关深度攻略 (反向关联)** | **V2.1 新增。** 列表展示所有关联到该角色的攻略文章标题和日期。 | FR403, FR414   |



### 3.4 强度排行榜页 (Tier List / `/tierlist`)



| **区域/组件**    | **功能介绍**                                        | **对应 FR-ID** |
| ---------------- | --------------------------------------------------- | -------------- |
| **模式筛选**     | 按钮切换：PvE 综合 / 无尽模式 / Boss 杀手。         | 前端 State     |
| **分级展示区块** | **SSS, SS, S, A, B** 等区块，用颜色和标题清晰区分。 | FR409          |
| **角色卡片**     | 每个区块内，按 Sanity 数组顺序展示角色头像和名称。  | FR410          |
| **榜单说明**     | 显示榜单版本号 (`V1.5`) 和评级标准表格。            | FR411          |



### 3.5 兑换码大全页 (Codes / `/codes`)



| **区域/组件**    | **功能介绍**                                                 | **对应 FR-ID** |
| ---------------- | ------------------------------------------------------------ | -------------- |
| **代码列表**     | 以表格或卡片形式展示所有代码、奖励和最后验证日期。           | FR404          |
| **状态过滤**     | 默认只显示 **Active (有效)** 代码。提供按钮切换到 Expired 列表。 | FR404          |
| **一键复制按钮** | 每个有效代码旁边必须有一个按钮，点击后自动复制代码。         | FR404          |



### 3.6 攻略文章详情页 (Article Detail / `/blog/[slug]`)



| **区域/组件**   | **功能介绍**                                                 | **对应 FR-ID**   |
| --------------- | ------------------------------------------------------------ | ---------------- |
| **文章正文区**  | 文章标题、作者、发布日期、以及主体内容 (Sanity Portable Text 渲染)。 | Sanity `article` |
| **侧边栏/底部** | **V2.1 核心。** 动态展示该文章关联到的所有角色的小卡片（头像、名称、Tier）。 | FR402, FR413     |
| **引流链接**    | 每个关联角色的卡片都必须链接到对应的 `/units/[slug]` 详情页。 | FR415            |



## 4. 数据建模与 CMS 架构 (Sanity Schemas)



所有核心内容均由 Sanity CMS 管理。

| **ID**  | **Schema 名称** | **对应文档类型** | **关键字段 (Fields)**                                        | **核心用途与关联**                             |
| ------- | --------------- | ---------------- | ------------------------------------------------------------ | ---------------------------------------------- |
| **S-1** | `item`          | 材料/物品        | `name`, `slug`, `image`                                      | 为 S-2 **Unit** 提供进化材料引用。             |
| **S-2** | `unit`          | 角色/单位        | `name`, `rarity`, `stats` (object), **`evolution_recipe` (array of reference to S-1)** | 核心数据库，被 S-3 和 S-5 引用。               |
| **S-3** | `tierList`      | 强度榜           | `title`, `version`, **`ranking_tiers` (array of reference to S-2)** | 单例文档 (Singleton)。存储角色排名和版本信息。 |
| **S-4** | `redeemCode`    | 兑换码           | `code_string`, `reward`, `status` (Active/Expired)           | 流量驱动，要求数据更新即时性。                 |
| **S-5** | `article`       | 攻略文章         | `title`, `body` (Portable Text), **`related_units` (array of reference to S-2)** | 启用双向关联的核心 Schema。                    |

------



## 5. 核心功能要求 (Functional Requirements)





### 4.1 实体关联系统 (Entity Linking) - **V2.0 核心**



| **ID**    | **模块**       | **需求描述**                                                 | **GROQ/前端实现要求**                                        |
| --------- | -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **FR401** | **CMS 后台**   | **双向录入：** 编辑 `article` 时，必须能够可视化地勾选或搜索关联 `unit`。 | `article` Schema 必须包含 `related_units` 字段。             |
| **FR402** | **文章页展示** | **正向关联：** 在 `/blog/[slug]` 页面侧边栏或底部，动态显示所有关联角色的 **头像、名称、稀有度**，并提供跳转链接。 | GROQ 查询 `article` 时，需使用 `->` 符号解引用 `related_units`。 |
| **FR403** | **角色页展示** | **反向关联：** 在 `/units/[slug]` 页面底部，自动生成 "相关深度攻略" 列表，列出所有引用了当前角色的文章标题。 | GROQ 必须使用反向引用查询：`*[_type == "article" && references($unitId)]`。 |



### 4.2 数据查询与 UX 要求



| **ID** | **模块**  | **需求描述**                                                 | **关键 UX/技术点**                                    |
| ------ | --------- | ------------------------------------------------------------ | ----------------------------------------------------- |
| FR404  | 兑换码    | 代码必须有**一键复制**按钮，并在前端根据 `status` 字段自动分组（Active 优先）。 | 前端 JS/Clipboard API                                 |
| FR405  | 进化配方  | 在 `/units/[slug]` 页面，进化材料必须以 **图标 + 数量** 的形式展示，图标 URL 通过 Sanity 引用 `item` Schema 获取。 | S-2 引用 S-1，前端渲染时使用 `urlFor` 助手。          |
| FR406  | Tier List | 榜单必须采用 **卡片/瀑布流布局**，角色头像必须是可点击的，并直观显示稀有度颜色。 | 需利用 Sanity Studio 的数组排序能力，前端按顺序渲染。 |

------



## 6. 技术与非功能要求 (Technical & Non-Functional)





### 5.1 技术栈与架构



| **组件**      | **技术栈/工具**               | **详情**                                                     |
| ------------- | ----------------------------- | ------------------------------------------------------------ |
| **前端框架**  | **Next.js 14.x (App Router)** | 所有数据获取均在 **Server Components** 中进行，以实现极致性能和 SEO。 |
| **CMS/数据**  | **Sanity.io (Headless CMS)**  | 数据源和可视化管理后台 (`/studio`)，使用 TypeScript 和 GROQ。 |
| **部署/CDN**  | **Vercel**                    | 托管和部署，必须配置 **Vercel Build Cache** 和 **Serverless Functions**。 |
| **语言/样式** | TypeScript / Tailwind CSS     | 保证代码质量和快速响应式设计。                               |



### 5.2 性能与维护



1. **实时更新 (ISR)：**
   - **核心实现：** 所有 Sanity 数据页面（`/units`, `/tierlist`, `/codes`）初始缓存时间应设置为 `revalidate: 60` (60秒)。
   - **终极目标：** 配置 **Sanity Webhooks**，在内容发布时，自动调用 Next.js 的 Revalidation API，实现 **On-Demand ISR** (即时更新)。
2. **图片优化：** 所有 Sanity 图片资产必须通过 `@sanity/image-url` 处理后，送入 Next.js 的 `Image` 组件，实现自动 WebP/AVIF 格式转换和按需加载。
3. **TS 类型安全：** 必须使用工具（如 `@sanity-typed` 或自定义脚本）从 Sanity Schemas 中生成 TypeScript 接口，确保前端数据结构的类型安全。



### 5.3 SEO 要求



- **标题/描述：** 所有 `/units/[slug]` 页面必须使用动态的、包含角色名称和关键词的元标签。
- **可访问性：** 所有内容必须在移动设备上完美响应（Mobile-First Design）。



## 7. 后续规划 (Future Scope - V1.1+)



| **优先级** | **功能模块**     | **描述**                                                     |
| ---------- | ---------------- | ------------------------------------------------------------ |
| P3         | DPS/Build 计算器 | 允许用户输入词条 (Traits)，计算理论最高伤害。                |
| P3         | 用户评论/反馈    | 引入 Disqus 或 Giscus，允许用户在角色页下留言。              |
| P4         | 词条/特性数据库  | 详细解释游戏内所有词条（如 Deadeye, Solar）的机制和概率。    |
| P4         | 模式攻略页       | 针对 Infinite Mode（无尽）或特定 Raid 关卡提供详细的图文或视频攻略。 |